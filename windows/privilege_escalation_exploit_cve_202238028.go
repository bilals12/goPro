//go:build windows
// +build windows

/*
ID: dffbd37c-d4c5-46f8-9181-5afdd9172b4c
NAME: Potential Privilege Escalation via CVE-2022-38028
CREATED: 2024-04-
scenario: hijacking print spooler service execution
placing malicious JS file in specific sysdirs
*/

package main

import (
	_ "embed"
	"os"
	Endpoint "github.com/preludeorg/test/endpoint"
)

var targetPaths = []string{
	"C:\\Windows\\system32\\DriverStore\\FileRepository\\MPDW-constraints.js",
	"C:\\Windows\\WinSxS\\amd64_microsoft-windows-printing-printtopdf_*\\MPDW-constraints.js",
}

func test() {
	// Simulate the exploitation attempt by creating a file in the target paths
	for _, path := range targetPaths {
		err := os.WriteFile(path, []byte("Exploit simulation content"), 0644)
		if err != nil {
			Endpoint.Say("Failed to write file: " + err.Error())
			Endpoint.Stop(101)
			return
		}
	}

	Endpoint.Say("Privilege escalation attempt simulated by writing to target paths")
	Endpoint.Stop(100)
}

func main() {
	Endpoint.Start(test)
}