//go:build darwin
// +build darwin

/*
ID: f85ce03f-d8a8-4c83-acdc-5c8cd0592be7
NAME: Suspicious Child Process of Adobe Acrobat Reader Update Service
CREATED: 2024-06-28
scenario: using PrivilegedHelperTool to exploit vulns [CVE-2020-9615, CVE-2020-9614, and CVE-2020-9613]
Suspicious Process Command: Uses sh to run open -a TextEdit, simulating a suspicious child process of Adobe Acrobat Reader's update service.
*/

package main

import (
	_ "embed"
	"runtime"

	Endpoint "github.com/preludeorg/test/endpoint"
)

var supported = map[string][]string{
	"darwin": {"sh", "-c", "open -a TextEdit"},
}

func test() {
	println("[+] Simulating suspicious child process of Adobe Acrobat Reader update service")

	// Simulate running a suspicious process as a child of Adobe's update service
	command := supported[runtime.GOOS]
	_, err := Endpoint.Shell(command)
	if err != nil {
		println("[+] Execution was prevented")
		Endpoint.Stop(100)
		return
	}

	println("[-] Suspicious child process was not blocked")
	Endpoint.Stop(101)
}

func main() {
	Endpoint.Start(test)
}